services:
  xangi:
    build: .
    container_name: xangi
    restart: unless-stopped
    volumes:
      # Claude Code CLI 認証情報（コンテナ専用ボリューム）
      - claude-data:/home/node/.claude
      # Codex CLI 認証情報（コンテナ専用ボリューム）
      - codex-data:/home/node/.codex
      # ワークスペース（エージェントの作業ディレクトリ）
      - ${WORKSPACE_PATH:-./workspace}:/workspace
      # Git設定
      - ~/.gitconfig:/home/node/.gitconfig:ro
    environment:
      # GitHub CLI (GH_TOKEN環境変数で認証)
      - GH_TOKEN=${GH_TOKEN:-}
      - NODE_ENV=production
      # Discord
      - DISCORD_TOKEN=${DISCORD_TOKEN:-}
      - AUTO_REPLY_CHANNELS=${AUTO_REPLY_CHANNELS:-}
      - DISCORD_STREAMING=${DISCORD_STREAMING:-true}
      - DISCORD_SHOW_THINKING=${DISCORD_SHOW_THINKING:-true}
      # Slack
      - SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN:-}
      - SLACK_APP_TOKEN=${SLACK_APP_TOKEN:-}
      - SLACK_SIGNING_SECRET=${SLACK_SIGNING_SECRET:-}
      - SLACK_AUTO_REPLY_CHANNELS=${SLACK_AUTO_REPLY_CHANNELS:-}
      - SLACK_REPLY_IN_THREAD=${SLACK_REPLY_IN_THREAD:-true}
      - SLACK_STREAMING=${SLACK_STREAMING:-true}
      - SLACK_SHOW_THINKING=${SLACK_SHOW_THINKING:-true}
      # Common
      - DISCORD_ALLOWED_USER=${DISCORD_ALLOWED_USER}
      - SLACK_ALLOWED_USER=${SLACK_ALLOWED_USER:-}
      - WORKSPACE_PATH=/workspace
      - SKIP_PERMISSIONS=${SKIP_PERMISSIONS:-false}
      # Agent
      - AGENT_BACKEND=${AGENT_BACKEND:-claude-code}
      - AGENT_MODEL=${AGENT_MODEL:-}

volumes:
  claude-data:
    name: xangi_claude-data
  codex-data:
    name: xangi_codex-data
